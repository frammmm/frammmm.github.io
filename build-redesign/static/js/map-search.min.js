(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{224:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,"default",function(){return MapSearch}),__webpack_require__(0),__webpack_require__(1),__webpack_require__(6),__webpack_require__(20),__webpack_require__(45),__webpack_require__(29),__webpack_require__(8),__webpack_require__(39),__webpack_require__(2),__webpack_require__(46),__webpack_require__(11),__webpack_require__(26),__webpack_require__(58),__webpack_require__(59),__webpack_require__(3),__webpack_require__(38),__webpack_require__(63),__webpack_require__(7),__webpack_require__(218),__webpack_require__(104),__webpack_require__(4),__webpack_require__(37),__webpack_require__(159),__webpack_require__(61),__webpack_require__(105),__webpack_require__(9),__webpack_require__(5);var axios__WEBPACK_IMPORTED_MODULE_27__=__webpack_require__(15),axios__WEBPACK_IMPORTED_MODULE_27___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_27__),moveto__WEBPACK_IMPORTED_MODULE_28__=__webpack_require__(40),moveto__WEBPACK_IMPORTED_MODULE_28___default=__webpack_require__.n(moveto__WEBPACK_IMPORTED_MODULE_28__),perfect_scrollbar__WEBPACK_IMPORTED_MODULE_29__=__webpack_require__(33),gsap_TweenLite__WEBPACK_IMPORTED_MODULE_30__=__webpack_require__(10),_location_tabs_location_tabs__WEBPACK_IMPORTED_MODULE_31__=__webpack_require__(219),_components_modal_modal__WEBPACK_IMPORTED_MODULE_32__=__webpack_require__(106),_taginator_taginator__WEBPACK_IMPORTED_MODULE_33__=__webpack_require__(220),_cookie_cookie__WEBPACK_IMPORTED_MODULE_34__=__webpack_require__(32),_form_input_search_input_search_input__WEBPACK_IMPORTED_MODULE_35__=__webpack_require__(111),_filter_search_filter_search_helpers__WEBPACK_IMPORTED_MODULE_36__=__webpack_require__(110),_sliders_complex_item_slider_complex_item_slider__WEBPACK_IMPORTED_MODULE_37__=__webpack_require__(62),_favorite_favorite__WEBPACK_IMPORTED_MODULE_38__=__webpack_require__(65),_compare_compare_storage__WEBPACK_IMPORTED_MODULE_39__=__webpack_require__(66),_filter_search_search_counter__WEBPACK_IMPORTED_MODULE_40__=__webpack_require__(217),_GUI_ymaps_controls_zoom_zoom__WEBPACK_IMPORTED_MODULE_41__=__webpack_require__(67),_phone_number_phone_number__WEBPACK_IMPORTED_MODULE_42__=__webpack_require__(60),_helpers_getPromiseState__WEBPACK_IMPORTED_MODULE_43__=__webpack_require__(221),_content_search_content_search_helpers__WEBPACK_IMPORTED_MODULE_44__=__webpack_require__(18);function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);"function"==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var MapSearch=function(){function MapSearch(element){var _this=this;!function(instance,Constructor){if(!(instance instanceof MapSearch))throw new TypeError("Cannot call a class as a function")}(this),this.isRedirect=element.getAttribute("data-redirect"),this.classes={form:"map-filter-n-2__form",inputs:"map-filter-n-2__inputs",scrollableContainer:"map-filter-n-2__scrollable-container",resetButton:"resetting-button-n-2",filterMoreButton:"additional-btn-n-2",filterMoreButtonText:"additional-btn-n-2__text",submitButton:"map-filter-n-2__search-page-button button",advancedParametres:"advanced-parametrs-n-2",advancedParametresTabs:"advanced-parametrs-n-2__location-tabs",changeTypeButton:"type-button-n-2",priceBlock:"map-filter-n-2__price-group",switchableContent:"switchable-content",switchableContentNext:"switchable-content__item_next",switchableContentCardDetails:"card-details",switchableContentCardList:"card-details__list",locationCityTab:"location-city-tab-n-2__input",locationParametrsTab:"advanced-parametrs-n-2__location-tab",tagBase:"tag-filter-n-2",tagsWrapper:"advanced-parametrs-n-2__tags",checkboxBlock:"checkbox-block-n-2",sortCondition:"#filter-search-sort"},this.filter=element,this.form=this.filter.querySelector(".".concat(this.classes.form)),this.scrollableContainer=this.filter.querySelector(".".concat(this.classes.scrollableContainer)),this.submitButton=this.filter.querySelector(".".concat(this.classes.submitButton)),this.priceBlock=this.filter.querySelector(".".concat(this.classes.priceBlock)),this.priceBlockControl=this.priceBlock.querySelector(".range-block-n-2"),this.switchableContent=document.querySelector(".".concat(this.classes.switchableContent)),this.switchableContentNext=this.switchableContent.querySelector(".".concat(this.classes.switchableContentNext)),this.switchableContentCardDetails=this.switchableContentNext.querySelector(".".concat(this.classes.switchableContentCardDetails)),this.switchableContentCardList=this.switchableContentNext.querySelector(".".concat(this.classes.switchableContentCardList)),this.switchableContentBack=this.switchableContentNext.querySelector(".card-details__back-button"),this.resetButton=this.filter.querySelector(".".concat(this.classes.resetButton)),this.filterMoreButton=this.filter.querySelector(".".concat(this.classes.filterMoreButton)),this.advancedParametresBlock=this.filter.querySelector(".".concat(this.classes.advancedParametres)),this.advancedCityTabs=this.filter.querySelector(".advanced-location-city-tabs"),this.arrayCheckboxBlocks=this.filter.querySelectorAll(".".concat(this.classes.checkboxBlock)),this.searchListButton=this.filter.querySelector('[data-type="list"]'),this.mapLegend=document.querySelector(".map-legend"),this.mapLegendItems=_toConsumableArray(document.querySelectorAll(".map-legend__item")),this.mapSearchWrapper=document.querySelector(".map-search-wrapper-n-2"),this.mapSearchContainer=document.querySelector("#map-search"),this.mapContainer=document.querySelector(".map-search-n-2"),this.fullscreenContainer=document.querySelector(".fullscreen-container"),this.filterMoreButtons=_toConsumableArray(this.filter.querySelectorAll(".".concat(this.classes.filterMoreButton))),this.filterMoreButtonsTexts=_toConsumableArray(this.filter.querySelectorAll(".".concat(this.classes.filterMoreButtonText))),this.filterMoreButtonsDefaultTexts=this.filterMoreButtonsTexts.map(function(button){return button.innerText}),this.ymaps=window.ymaps,this.advancedCheckboxes=this.filter.querySelector(".checkbox-group-n-2"),this.advancedTags=this.filter.querySelector(".advanced-parametrs-n-2__tags"),this.cardDetailsPs=new perfect_scrollbar__WEBPACK_IMPORTED_MODULE_29__.a(this.switchableContentCardDetails,{suppressScrollX:!0}),this.advancedTagsPs=new perfect_scrollbar__WEBPACK_IMPORTED_MODULE_29__.a(this.advancedTags),this.ps=new perfect_scrollbar__WEBPACK_IMPORTED_MODULE_29__.a(this.scrollableContainer,{suppressScrollX:!0}),this.moveTo=new moveto__WEBPACK_IMPORTED_MODULE_28___default.a;var cookies=new _cookie_cookie__WEBPACK_IMPORTED_MODULE_34__.a,domainName=location.hostname.split(".")[0],prefix="novostroev"===domainName?"":"".concat(domainName,"-"),geoCookie=cookies.getCookie("".concat(prefix,"geo-city"));this.cityIds=geoCookie?geoCookie.split(","):[],this.mapCenter=this.cityIds.includes("16")||this.cityIds.includes("24")?[59.940422,30.313795]:[55.741075,37.624988],this.mapBnds=[[0,0],[0,0]],this.zoom=11,this.imageLink="localhost"===window.location.hostname?"/static/img/minified-svg/":"/build-redesign/static/img/minified-svg/",this.clusterHref=this.imageLink+"maps-cluster.svg",this.clusterBigHref=this.imageLink+"maps-cluster.svg",this.searchLoadFlg=!1,this.searchInitFlg=!1,this.initialRequest=!0,this.searchAjaxUrlItem=this.mapSearchWrapper.getAttribute("data-request-url"),this.clusterer=null,this.mapSet={center:this.mapCenter?this.mapCenter:null,zoom:this.zoom?this.zoom:null,behaviors:["drag","dblClickZoom","rightMouseButtonMagnifier","multiTouch","scrollZoom"],controls:[]},this.mapPlacemarks={},this.customIcon={iconLayout:"default#image",iconImageSize:[18,18],iconImageOffset:[-17,-17]};var tabs=new _location_tabs_location_tabs__WEBPACK_IMPORTED_MODULE_31__.a({switchType:"checkbox",switchContainer:".location-city-tabs-n-2",tabsContainer:".map-filter-n-2__location-groups .advanced-location-city-tabs"});this.tags=new _taginator_taginator__WEBPACK_IMPORTED_MODULE_33__.a(this.classes.tagBase,".".concat(this.classes.tagsWrapper)),this.blockTriggering=!1,this.createFloatingBlock(),this.renderMap(this.mapSet),this.bindEvents(),tabs.request().then(function(){_this.locationCityTabs=document.querySelectorAll(".".concat(_this.classes.locationCityTab)),_this.locationParametrsTabs=document.querySelectorAll(".".concat(_this.classes.locationParametrsTab)),_this.bindLocationEvent(),_this.locationParametrsTabs.forEach(function(el){_components_modal_modal__WEBPACK_IMPORTED_MODULE_32__.a.init({container:el,triggersSelector:".location-button-n-2[data-toggle]",modal:{backdropContainer:_this.advancedCityTabs}})}),_form_input_search_input_search_input__WEBPACK_IMPORTED_MODULE_35__.a.init(),_this.bootstrapTags(),_this.checkingSelection(),_this.restoreTags(),_this.searchCounter=new _filter_search_search_counter__WEBPACK_IMPORTED_MODULE_40__.a(element,{useCache:!0,customSerialize:_this.serialize.bind(_this),excludeInputs:["f[price][from]","f[price][to]","f[square-meter]"]})})}var Constructor,protoProps;return Constructor=MapSearch,(protoProps=[{key:"createFloatingBlock",value:function(){var _this2=this;this.mapSearchFloatingResult=document.createElement("div"),this.mapSearchFloatingResult.className="map-results",this.mapSearchFloatingText=document.createElement("span");var closeButton=document.createElement("button");closeButton.className="map-results__close",closeButton.innerHTML='<svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n<rect width="8" height="8" fill="black" fill-opacity="0" transform="translate(1 1)"/>\n<path d="M1 1L9 9" stroke="#D4DBE3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n<path d="M9 1L1 9" stroke="#D4DBE3" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n</svg>',closeButton.addEventListener("click",function(){_this2.hideFloatingBlock()}),this.mapSearchFloatingResult.appendChild(this.mapSearchFloatingText),this.mapSearchFloatingResult.appendChild(closeButton),this.mapContainer.appendChild(this.mapSearchFloatingResult)}},{key:"hideFloatingBlock",value:function(){this.floatingState="hidden",gsap_TweenLite__WEBPACK_IMPORTED_MODULE_30__.a.to(this.mapSearchFloatingResult,.5,{y:"30px",opacity:0,display:"none"})}},{key:"showFloatingBlock",value:function(text){this.mapSearchFloatingText.innerText=text,this.floatingState||(gsap_TweenLite__WEBPACK_IMPORTED_MODULE_30__.a.fromTo(this.mapSearchFloatingResult,.5,{y:"30px",opacity:0,delay:1e4},{y:0,opacity:1,display:"block"}),this.floatingState="show")}},{key:"renderMap",value:function(params){var _this3=this;return this.ymaps.ready(function(){var zoomControl=Object(_GUI_ymaps_controls_zoom_zoom__WEBPACK_IMPORTED_MODULE_41__.a)(_this3.ymaps,{top:"20px",left:"20px"});_this3.map=new _this3.ymaps.Map(_this3.mapSearchContainer,params,{suppressMapOpenBlock:!0}),_this3.map.controls.add(zoomControl),_this3.mapManager=new _this3.ymaps.ObjectManager({clusterize:!1}),_this3.mapManager.objects.events.add("click",function(e){var currentItemId=e.get("objectId");if(_this3.selectedPlacemarkId!==currentItemId){_this3.selectedPlacemarkId&&_this3.resetPlacemarkIcon(currentItemId);var currentItem=_this3.mapManager.objects.getById(currentItemId),itemOriginalIcon=currentItem.properties.originalIcon;_this3.mapManager.objects.setObjectOptions(currentItemId,{iconImageHref:itemOriginalIcon.replace(".svg","-selected.svg")}),_this3.getItemInfo(currentItemId,currentItem.properties.adv),_this3.selectedPlacemarkId=currentItemId}}),location.search.length?_this3.request(!0,!0):_this3.request(!0),_this3.mapLegend.classList.add("loaded"),_this3.createFullscreenButton()})}},{key:"createFullscreenButton",value:function(){var _this4=this,buttonContainer=document.createElement("div");buttonContainer.className="map-search__fullscreen-control";var button=document.createElement("button");button.className="ymaps-control__button",button.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>',button.addEventListener("click",function(){return _this4.toggleFullscreen()}),buttonContainer.appendChild(button),this.mapContainer.appendChild(buttonContainer)}},{key:"toggleFullscreen",value:function(){this.fullscreenContainer&&(this.fullscreenContainer.classList.toggle("is-active"),this.map&&this.map.container.fitToViewport())}},{key:"checkingSelection",value:function(){var chosenItems=0;_toConsumableArray(this.form.querySelectorAll('input[type="text"]')).forEach(function(input){["f[price][from]","f[price][to]"].includes(input.name)||input.value&&(chosenItems+=1)}),chosenItems+=+this.form.querySelectorAll('input:checked:not([name="f[square-meter]"])').length,this.priceBlockControl&&this.priceBlockControl.RangeSelect&&(chosenItems+=!this.priceBlockControl.RangeSelect.isReseted),chosenItems?(this.form.classList.add("map-filter-n-2__form_has-value"),this.mapContainer.classList.add("map-search-n-2_has-value")):(this.form.classList.remove("map-filter-n-2__form_has-value"),this.mapContainer.classList.remove("map-search-n-2_has-value")),this.map&&this.map.container&&this.map.container.fitToViewport()}},{key:"bindLocationEvent",value:function(){var _this5=this;_toConsumableArray(this.locationCityTabs).forEach(function(regionTab){regionTab.addEventListener("change",function(){_this5.changeLocationParamsTab()})})}},{key:"changeLocationParamsTab",value:function(){var nameTab=(_toConsumableArray(this.locationCityTabs).find(function(tab){return tab.checked})||this.locationCityTabs[0]).getAttribute("data-city-tab");_toConsumableArray(this.locationParametrsTabs).forEach(function(paramTab){var nameType=paramTab.getAttribute("data-city");nameTab===nameType?paramTab.classList.add("advanced-parametrs-n-2__location-tab_active"):paramTab.classList.remove("advanced-parametrs-n-2__location-tab_active")})}},{key:"bootstrapTags",value:function(){var _this6=this,searchRequestTags=[];if(window.location.search){window.location.search.substr(1).split("&").forEach(function(group){var item=group.split("=");searchRequestTags.push({key:decodeURIComponent(item[0]),value:decodeURIComponent(item[1])})}),this.resetFilter();var formInputs=_toConsumableArray(this.form.querySelectorAll("input"));searchRequestTags.forEach(function(tag){var input,key=tag.key,value=tag.value;if(value&&(input=key.endsWith("[]")?formInputs.find(function(formInput){return formInput.getAttribute("value")===value}):formInputs.find(function(formInput){return formInput.getAttribute("name")===key}))){if(["f[price][from]","f[price][to]"].includes(input.name))return void _this6.priceBlockControl.RangeSelect.updateRangeSliderValues(value,"f[price][from]"===input.name?0:1);"checkbox"===input.getAttribute("type")||"radio"===input.getAttribute("type")?input.checked=!0:input.value=value,null!==input.closest("[modal-type]")&&_this6.chooseLocation(input.closest("[modal-type]").getAttribute("modal-type"))}}),this.changeLocationParamsTab()}}},{key:"restoreTags",value:function(){var _this7=this;document.createEvent("Event").initEvent("input",!1,!0),_toConsumableArray(this.form.querySelectorAll("input")).forEach(function(input){"checkbox"===input.getAttribute("type")&&!0===input.checked&&_this7.showCheckedElement(input),""===input.value&&!1===input.checked||"INPUT"!==input.nodeName||_this7.toggleTag(input)})}},{key:"showCheckedElement",value:function(inputElement){var event=document.createEvent("Event");event.initEvent("change",!1,!0),inputElement.closest(".filter-select-n-2__popup")&&document.querySelector(".filter-select-n-2__popup").dispatchEvent(event),inputElement.closest(".checkbox-block-n-2")&&inputElement.closest(".checkbox-block-n-2__popup").dispatchEvent(event)}},{key:"popstate",value:function(){var _this8=this;this.isPopstate=!0;var nextState=history.state;if(!nextState)return this.restoreTags(),this.request().then(function(){return _this8.isPopstate=!1});this.restoreTags(nextState.form),this.request(nextState.query).then(function(){_this8.isPopstate=!1})}},{key:"defferedRequest",value:function(){for(var _this9=this,_len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){return _this9.request.apply(_this9,args)},500)}},{key:"request",value:function(){var _this10=this,setCenter=arguments.length>0&&void 0!==arguments[0]&&arguments[0],isPopstate=arguments.length>1&&void 0!==arguments[1]&&arguments[1],boundsChange=arguments.length>2&&void 0!==arguments[2]&&arguments[2],url=this.form.getAttribute("action"),serializationObject=this.serialize(setCenter,isPopstate);this.searchLoadFlg=!0,Object(_helpers_getPromiseState__WEBPACK_IMPORTED_MODULE_43__.a)(this.searchCounter.query).then(function(promiseState){if(!_this10.searchCounter.cache||"fulfilled"!==promiseState)return _this10.searchCounter.query&&"pending"===promiseState&&(_this10.searchCounter.requestSource.cancel(),_this10.searchCounter.reset()),boundsChange||_this10.mapSearchContainer.classList.add("map-search_loading"),axios__WEBPACK_IMPORTED_MODULE_27___default.a.get("".concat(url,"?").concat(serializationObject.requestData),{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(response){var data=response.data;_this10.isPopstate||isPopstate||history.pushState(serializationObject.dataObject,"Search-request","?".concat(serializationObject.requestData)),_this10.onRequest(data,setCenter)}).finally(function(){_this10.buttonClick=!1,_this10.blockTriggering=!1,_this10.mapSearchContainer.classList.remove("map-search_loading"),_this10.submitButton.disabled=!1});_this10.onRequest(_this10.searchCounter.cache.data,_this10.searchCounter.cache.serializationObject),_this10.searchCounter.requestSource.cancel()})}},{key:"onRequest",value:function(data,setCenter){return data&&(data.items&&data.items.length?this.addToCluster(data.items,setCenter):this.clearMap(),data.items_total&&this.showFloatingBlock("Мы подобрали ".concat(data.items_total," ").concat(Object(_filter_search_filter_search_helpers__WEBPACK_IMPORTED_MODULE_36__.b)(data.items_total,"объект",["ов","а",""])," для вас"))),this.searchLoadFlg=!1,data}},{key:"toggleTag",value:function(inputElement){var _this11=this,currentInput=inputElement,inputParent=currentInput.closest("[data-tag-name]");if(!inputParent)return new Promise(function(resolve){resolve(!0)});var siblingInputs=inputParent.querySelectorAll("input"),id=inputParent.getAttribute("data-tag-id"),name=inputParent.getAttribute("data-tag-name"),suffix=inputParent.getAttribute("data-input-suf"),inputType=currentInput.getAttribute("type")||"select",inputValues=[],toggle=function(){_toConsumableArray(siblingInputs).forEach(function(element){var prefix=element.getAttribute("data-input-pref")||"";["radio","checkbox"].includes(element.type)||element.value.length&&inputValues.push("".concat(prefix," ").concat(element.value," "))}),inputValues.length?_this11.tags.findTag(id)?_this11.tags.changeTag(id,inputValues.join(" ")):_this11.tags.createTag(siblingInputs,id,name,inputValues.join(" "),suffix):_this11.tags.removeTag(id),_this11.checkingSelection()};switch(inputType){case"text":case"search":toggle();break;case"checkbox":case"radio":siblingInputs.length>1?toggle():siblingInputs[0].checked?this.tags.createTag(siblingInputs,id,name):this.tags.removeTag(id);break;case"select":(inputValues="").length?this.tags.findTag(id)?this.tags.changeTag(id,inputValues.trim()):this.tags.createTag(siblingInputs,id,"",inputValues.trim()):this.tags.removeTag(id)}var tagsAmount=this.tags.items.length;return 20!==tagsAmount||this.tagsExpander?tagsAmount>20?document.querySelector("[data-tags-amount]").innerText=tagsAmount:this.tagsExpander&&(this.tagsExpander.remove(),this.tagsExpander=null,document.querySelector(".".concat(this.classes.tagsWrapper)).classList.remove("".concat(this.classes.tagsWrapper,"_are_expanded"))):(this.tagsExpander=document.createElement("div"),this.tagsExpander.classList=this.classes.tagBase,this.tagsExpander.setAttribute("data-tags-expander",""),this.tagsExpander.innerHTML='\n        <div class="'.concat(this.classes.tagBase,'__name">\n          <span class="').concat(this.classes.tagBase,'_amount">Ещё&nbsp;<span data-tags-amount="">').concat(tagsAmount,'</span>&nbsp;фильтров</span>\n          <span class="').concat(this.classes.tagBase,'_hider">Скрыть фильтры</span>\n        </div>\n      '),document.querySelector(".".concat(this.classes.tagsWrapper)).appendChild(this.tagsExpander),document.querySelector("[data-tags-expander]").addEventListener("click",function(event){event.stopImmediatePropagation();var tagsWrapper=document.querySelector(".".concat(_this11.classes.tagsWrapper));tagsWrapper.classList.contains("".concat(_this11.classes.tagsWrapper,"_are_expanded"))?tagsWrapper.classList.remove("".concat(_this11.classes.tagsWrapper,"_are_expanded")):tagsWrapper.classList.add("".concat(_this11.classes.tagsWrapper,"_are_expanded"))})),new Promise(function(resolve){resolve(!0)})}},{key:"resetFilter",value:function(){return this.searchCounter&&this.searchCounter.reset(),_toConsumableArray(this.form.querySelectorAll("input")).forEach(function(input){["f[square-meter]","f[price][from]","f[price][to]"].includes(input.name)||("checkbox"===input.getAttribute("type")?input.checked=!1:input.value="")}),this.resetPrice(),this.resetCheckboxBlock(),this.resetLocationButtons(),this.tags.reset(),new Promise(function(resolve){resolve(!0)})}},{key:"resetCheckboxBlock",value:function(){_toConsumableArray(this.arrayCheckboxBlocks).forEach(function(checkboxBlock){var outputText,typeCheck=checkboxBlock.getAttribute("type-check"),extra=checkboxBlock.querySelector(".checkbox-block-n-2__extra-tag"),checked=checkboxBlock.querySelector(".checkbox-block-n-2__checked-elements");switch(typeCheck){case"square-meter":return;case"room-expanded":outputText="Выберите кол-во комнат";break;case"date-expanded":outputText="Срок сдачи объекта";break;default:outputText="Любой"}extra.classList.add("hide"),extra.querySelector(".extra-tag-n-2").innerText="",checked.innerHTML=outputText})}},{key:"resetPrice",value:function(){this.priceBlockControl&&this.priceBlockControl.RangeSelect&&this.priceBlockControl.RangeSelect.clearingInputs()}},{key:"resetLocationButtons",value:function(){_toConsumableArray(document.querySelectorAll(".location-button-n-2")).forEach(function(locationButton){locationButton.querySelector(".extra-tag-n-2").innerHTML="",locationButton.classList.remove("location-button-n-2_has-value")})}},{key:"resetLocationModal",value:function(nameTypeLocation,locationModal){var _this12=this;_toConsumableArray(locationModal.querySelectorAll("input:checked")).forEach(function(input){input.checked=!1,_this12.toggleTag(input)}),this.chooseLocation(nameTypeLocation);var event=document.createEvent("Event");event.initEvent("change",!1,!0),this.form.dispatchEvent(event)}},{key:"chooseLocation",value:function(nameTypeLocation){var _this13=this,locationButton=document.querySelector('[href="#'.concat(nameTypeLocation,'"]')),locationModal=document.querySelector('[modal-type="'.concat(nameTypeLocation,'"]')),checkedLengthElements=locationModal.querySelectorAll("input:checked").length;locationModal.querySelector(".resetting-button-n-2").addEventListener("click",function(){_this13.resetLocationModal(nameTypeLocation,locationModal)}),locationButton.querySelector(".location-button-n-2__close").addEventListener("click",function(event){event.stopPropagation(),_this13.resetLocationModal(nameTypeLocation,locationModal)}),checkedLengthElements?(locationButton.querySelector(".extra-tag-n-2").innerHTML=checkedLengthElements,locationButton.classList.add("location-button-n-2_has-value")):(locationButton.querySelector(".extra-tag-n-2").innerHTML="",locationButton.classList.remove("location-button-n-2_has-value"))}},{key:"changeDot",value:function(value){return value.replace(".",",")}},{key:"bindEvents",value:function(){var _this14=this;window.addEventListener("popstate",function(){_this14.popstate()}),this.mapLegendItems.forEach(function(button){button.addEventListener("click",function(){var min=button.getAttribute("data-price-min"),max=button.getAttribute("data-price-max");_this14.mapLegendItems.forEach(function(otherButton){otherButton!==button&&otherButton.classList.remove("is-active")}),button.classList.add("is-active");var priceTypeCheckbox=document.querySelector('[name="f[square-meter]"][value="all"]');if(priceTypeCheckbox){priceTypeCheckbox.checked=!0,priceTypeCheckbox.dispatchEvent(new CustomEvent("change",{bubbles:!0}));var dataValue=priceTypeCheckbox.getAttribute("data-value"),output=_this14.priceBlock.querySelector(".checkbox-block-n-2__checked-elements");output&&(output.innerHTML=dataValue)}_this14.priceBlockControl.RangeSelect.updateRangeSliderValues(min||0,0),_this14.priceBlockControl.RangeSelect.updateRangeSliderValues(max||999999999,1),_this14.request(!0)})}),this.form.addEventListener("submit",function(event){event.preventDefault(),_this14.request(!0)}),this.form.addEventListener("change",function(event){_this14.mapLegendItems.forEach(function(button){button.classList.remove("is-active")}),_this14.checkingSelection(),null!==event.target.closest("[modal-type]")&&_this14.chooseLocation(event.target.closest("[modal-type]").getAttribute("modal-type")),setTimeout(function(){_this14.toggleTag(event.target)},1)}),_toConsumableArray(this.priceBlock.querySelectorAll("input, select")).forEach(function(input){input.addEventListener("focus",function(){_this14.moveTo.move(input)}),input.addEventListener("change",function(){_this14.defferedRequest(!0)})}),this.submitButton.addEventListener("click",function(event){event.preventDefault(),_this14.advancedParametresBlock.classList.remove("advanced-parametrs-n-2_active"),_this14.checkingSelection(),_this14.filterMoreButton.classList.remove("additional-btn-n-2_active"),_this14.switchableContent.classList.remove("is-open"),_this14.advancedParametresBlock.classList.remove("advanced-parametrs-n-2_active"),_this14.scrollableContainer.scrollTop=0,_this14.submitButton.disabled=!0,_this14.mapLegendItems.forEach(function(button){button.classList.remove("is-active")}),setTimeout(function(){_this14.buttonClick=!0,_this14.request(!0)},1)}),this.resetButton.addEventListener("click",function(event){event.preventDefault(),_this14.blockTriggering=!0,_this14.resetFilter().then(function(){_this14.mapLegendItems.forEach(function(button){button.classList.remove("is-active")}),_this14.request(!0),_this14.checkingSelection()})}),_toConsumableArray(this.form.querySelectorAll('input[type="text"]')).forEach(function(inputElement){"input cut paste".split(" ").forEach(function(event){return inputElement.addEventListener(event,function(eventInner){eventInner.currentTarget.value=_this14.changeDot(eventInner.currentTarget.value),_this14.blockTriggering||_this14.toggleTag(eventInner.currentTarget)})})}),this.filterMoreButtons.forEach(function(node){return node.addEventListener("click",function(event){var currentButton=event.currentTarget;currentButton.classList.contains("".concat(_this14.classes.filterMoreButton,"_active"))?(currentButton.classList.remove("".concat(_this14.classes.filterMoreButton,"_active")),_this14.switchableContent.classList.remove("is-open"),_this14.advancedParametresBlock.classList.remove("".concat(_this14.classes.advancedParametres,"_active")),_this14.filterMoreButtonsTexts.forEach(function(button,index){button.innerText=_this14.filterMoreButtonsDefaultTexts[index]}),_this14.scrollableContainer.scrollTop=0,_this14.ps.update()):(currentButton.classList.add("".concat(_this14.classes.filterMoreButton,"_active")),_this14.switchableContent.classList.add("is-open"),_this14.advancedParametresBlock.classList.add("".concat(_this14.classes.advancedParametres,"_active")),_this14.filterMoreButtonsTexts.forEach(function(button){button.innerText="Скрыть"}))})}),this.searchListButton.addEventListener("click",function(event){event.preventDefault(),window.location.href="".concat(_this14.searchListButton.href,"?").concat(_this14.serialize().requestData)}),this.switchableContentBack.addEventListener("click",function(){_this14.switchableContent.classList.remove("is-detailed"),_this14.selectedPlacemarkId&&_this14.resetPlacemarkIcon(),setTimeout(function(){_this14.switchableContentNext.style.display=""},350)})}},{key:"serialize",value:function(){var data=Object(_content_search_content_search_helpers__WEBPACK_IMPORTED_MODULE_44__.c)(this.form,{hash:!0});delete data["f[geo][]"],delete data["f[price][from]"],delete data["f[price][to]"];var priceRange=this.priceBlockControl.RangeSelect.trueValues;data["f[price][from]"]=priceRange.inputBefore,data["f[price][to]"]=priceRange.inputAfter;var stringifiedData=Object(_content_search_content_search_helpers__WEBPACK_IMPORTED_MODULE_44__.b)(data),advancedGeoParams=_toConsumableArray(this.form.querySelectorAll(".advanced-parametrs-n-2__location-tabs .checkbox-container-n-2__input:checked"));if(advancedGeoParams.length)advancedGeoParams.forEach(function(param){var geoValue=param.getAttribute("data-value");stringifiedData+="&f[geo][]=".concat(geoValue)});else{var activeTabs=_toConsumableArray(this.form.querySelectorAll(".location-city-tab-n-2__input:checked"));activeTabs.length?activeTabs.forEach(function(tab){var geoValue=tab.getAttribute("data-value");stringifiedData+="&f[geo][]=".concat(geoValue)}):this.cityIds.forEach(function(id){stringifiedData+="&f[geo][]=".concat(id)})}var location=document.querySelector(".location-city-tab-n-2.active")?document.querySelector(".location-city-tab-n-2.active").getAttribute("data-city-tab"):"";return{dataObject:data,requestData:stringifiedData,location:location}}},{key:"addToCluster",value:function(items,setCenter){var _this15=this,placemarksToAppend=[];setCenter&&this.clearMap(),items.forEach(function(item){var id=item.id;if(!_this15.mapPlacemarks[id]){var icon=_objectSpread({},_this15.customIcon);item.adv?(icon.iconImageHref="".concat(_this15.imageLink,"maps-baloon-adv-map.svg"),icon.iconImageSize=[39.85,43.5]):icon.iconImageHref="".concat(_this15.imageLink,"maps-baloon-").concat(item.priceCategory||"green",".svg"),placemarksToAppend.push({type:"Feature",id:item.id,options:_objectSpread({},icon,{zIndex:item.adv?651:650,zIndexHover:item.adv?653:652}),properties:{adv:item.adv,id:item.id,originalIcon:icon.iconImageHref},geometry:{type:"Point",coordinates:item.location[0][0]}})}}),this.mapManager.removeAll(),this.mapManager.add({type:"FeatureCollection",features:placemarksToAppend}),this.map.geoObjects.add(this.mapManager),setCenter&&this.map.setBounds(this.mapManager.getBounds(),{checkZoomRange:!0})}},{key:"clearMap",value:function(){this.clusterer&&this.clusterer.removeAll(),this.placeMarks={}}},{key:"onMapInit",value:function(func){var _this16=this;this.searchInitFlg?func():setTimeout(function(){return _this16.onMapInit(func)},500)}},{key:"onMapLoad",value:function(func){var _this17=this;this.searchLoadFlg?setTimeout(function(){return _this17.onMapLoad(func)},500):func()}},{key:"getItemInfo",value:function(id,adv){var _this18=this;return fetch("".concat(this.searchAjaxUrlItem,"?id=").concat(id)).then(function(response){if(response.ok)return response.json()}).then(function(data){_this18.handleMapItemClick(data,adv)})}},{key:"handleMapItemClick",value:function(item,adv){var _this19=this;if(item){var itemRow=document.createElement("div");itemRow.className="row";var itemContainer=document.createElement("div");itemContainer.className="col col_xs-4 col_sm-6 col_md-12",itemRow.appendChild(Object(_filter_search_filter_search_helpers__WEBPACK_IMPORTED_MODULE_36__.a)(item,itemContainer)),this.switchableContentCardList.innerHTML="",this.switchableContentCardList.appendChild(itemRow),this.switchableContentNext.style.display="block",adv?this.switchableContentCardDetails.classList.add("card-details_promo"):this.switchableContentCardDetails.classList.remove("card-details_promo"),_phone_number_phone_number__WEBPACK_IMPORTED_MODULE_42__.a.init(),_sliders_complex_item_slider_complex_item_slider__WEBPACK_IMPORTED_MODULE_37__.a.init(),_favorite_favorite__WEBPACK_IMPORTED_MODULE_38__.a.init(),_compare_compare_storage__WEBPACK_IMPORTED_MODULE_39__.a.init(),setTimeout(function(){_this19.switchableContent.classList.add("is-detailed")},50)}}},{key:"resetPlacemarkIcon",value:function(){var currentItem=this.mapManager.objects.getById(this.selectedPlacemarkId),itemOriginalIcon=currentItem.properties.originalIcon,isAdv=currentItem.properties.adv;this.mapManager.objects.setObjectOptions(this.selectedPlacemarkId,{iconImageHref:isAdv?itemOriginalIcon:"".concat(this.imageLink,"maps-baloon-grey.svg")}),this.selectedPlacemarkId=null}}])&&_defineProperties(Constructor.prototype,protoProps),MapSearch}()}}]);