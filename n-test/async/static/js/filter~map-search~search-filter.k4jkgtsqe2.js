(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{268:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return initLocationInput});__webpack_require__(3),__webpack_require__(7),__webpack_require__(8),__webpack_require__(21),__webpack_require__(59),__webpack_require__(9),__webpack_require__(47),__webpack_require__(4),__webpack_require__(43),__webpack_require__(12),__webpack_require__(116),__webpack_require__(71),__webpack_require__(91),__webpack_require__(63),__webpack_require__(1),__webpack_require__(42),__webpack_require__(2),__webpack_require__(90),__webpack_require__(5),__webpack_require__(10),__webpack_require__(6);var axios__WEBPACK_IMPORTED_MODULE_21__=__webpack_require__(13),axios__WEBPACK_IMPORTED_MODULE_21___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_21__),perfect_scrollbar__WEBPACK_IMPORTED_MODULE_22__=__webpack_require__(44),_form_input_search_input_search_input_helpers__WEBPACK_IMPORTED_MODULE_23__=__webpack_require__(122),_helpers_constants__WEBPACK_IMPORTED_MODULE_24__=__webpack_require__(11);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable})),keys.push.apply(keys,symbols)}return keys}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var initLocationInput=function(container){var defaultTips,timeout,locationTips=_toConsumableArray(container.querySelectorAll(".location-input-n-2__tips-item")),locationInput=container.querySelector(".location-input-n-2 input"),locationTipsWrapper=container.querySelector(".location-input-n-2__tips"),dynamicLabel=container.querySelector(".location-input-n-2__dynamic-label"),bottomLine=container.querySelector(".location-input-n-2__bottom-line"),example=container.querySelector(".main-filter-n-2__example span"),locationTipsContainer=document.createElement("div");locationTipsContainer.className="location-input-n-2__tips-container slim-scrollbar",locationTipsWrapper.appendChild(locationTipsContainer);var searchType=container.getAttribute("data-search-type")||"buildings";new IntersectionObserver(function(entries,observer){if(entries[0].isIntersecting){new perfect_scrollbar__WEBPACK_IMPORTED_MODULE_22__.a(locationTipsContainer,{suppressScrollX:!0});observer.disconnect()}}).observe(locationTipsContainer);var closePopup=function(){locationTipsWrapper.classList.add("filter-popup-hide-n-2"),bottomLine.classList.remove("location-input-n-2__bottom-line_expanded"),""===locationInput.value&&dynamicLabel&&dynamicLabel.classList.remove("price-output-n-2__dynamic-label_lifted")},focusItemByDirection=function(direction){var nextItem,currentElementIndex=locationTips.indexOf(document.activeElement);direction===_helpers_constants__WEBPACK_IMPORTED_MODULE_24__.z?currentElementIndex>0?nextItem=locationTips[currentElementIndex-1]:0===currentElementIndex&&locationInput.focus():direction===_helpers_constants__WEBPACK_IMPORTED_MODULE_24__.d&&currentElementIndex>=0&&currentElementIndex<locationTips.length-1&&(nextItem=locationTips[currentElementIndex+1]),nextItem&&nextItem.focus()},selectCurrentItem=function(){var currentElementIndex=locationTips.indexOf(document.activeElement);if(currentElementIndex||0===currentElementIndex){var currentLocationTip=locationTips[currentElementIndex];locationInput.value=currentLocationTip.innerText,locationInput.dispatchEvent(new CustomEvent("change"))}},initTips=function(){(locationTips=_toConsumableArray(container.querySelectorAll(".location-input-n-2__tips-item"))).forEach(function(tip){tip.addEventListener("click",function(){locationInput.value=tip.innerText,locationInput.dispatchEvent(new CustomEvent("change")),closePopup()})}),locationTips.forEach(function(item){item&&(item.setAttribute("tabindex",0),item.addEventListener("keydown",function(event){switch(event.stopPropagation(),event.keyCode){case _helpers_constants__WEBPACK_IMPORTED_MODULE_24__.e:return event.preventDefault(),void selectCurrentItem();case _helpers_constants__WEBPACK_IMPORTED_MODULE_24__.d:return event.preventDefault(),void focusItemByDirection(_helpers_constants__WEBPACK_IMPORTED_MODULE_24__.d);case _helpers_constants__WEBPACK_IMPORTED_MODULE_24__.z:return event.preventDefault(),void focusItemByDirection(_helpers_constants__WEBPACK_IMPORTED_MODULE_24__.z);case _helpers_constants__WEBPACK_IMPORTED_MODULE_24__.f:return locationInput.focus(),void closePopup();default:return void(_helpers_constants__WEBPACK_IMPORTED_MODULE_24__.y.includes(event.keyCode)&&(event.preventDefault(),selectCurrentItem()))}}))})};""!==locationInput.value&&dynamicLabel&&dynamicLabel.classList.add("price-output-n-2__dynamic-label_lifted"),initTips();var templateLabel=function(item,url){return url?'<a href="'.concat(url,'" class="location-input-n-2__tips-item location-input-n-2__tips-item_link" tabindex="0">').concat(item,"</a>"):'<span class="location-input-n-2__tips-item" tabindex="0">'.concat(item,"</span>")},templateType=function(type){return'<div class="location-input-n-2__tips-category">'.concat(type,"</div>")},requestTips=function(){return axios__WEBPACK_IMPORTED_MODULE_21___default.a.get("/ajax/text_search_new_buildings.php",{params:{q:locationInput.value,t:searchType}}).then(function(res){if(0!==res.data.length){var result=[],types=[];res.data=res.data.map(function(item){return function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(source,!0).forEach(function(key){_defineProperty(target,key,source[key])}):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(source).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}return target}({substring:Object(_form_input_search_input_search_input_helpers__WEBPACK_IMPORTED_MODULE_23__.b)(locationInput.value,item.label)},item)}),res.data=res.data.sort(function(a,b){return a.substring.length<b.substring.length?1:-1}),res.data.forEach(function(item){types.includes(item.type_name)||(types.push(item.type_name),result.push(templateType(item.type_name))),result.push(templateLabel(item.label,item.url))}),locationTipsContainer.innerHTML=result.join(""),initTips()}return res})},requestDefaultTips=function(){return new Promise(function(resolve){defaultTips?resolve(defaultTips):axios__WEBPACK_IMPORTED_MODULE_21___default.a.get("/ajax/text_search_default_tips.php",{params:{q:locationInput.value,t:searchType}}).then(function(res){defaultTips=res,resolve(res),function(res){try{if(0!==res.data.length){var result={},types=[];res.data.forEach(function(item){var type=item.type_name;types.includes(type)||(types.push(type),result[type]=[],result[type].push(templateType(type))),result[type].push(templateLabel(item.label,item.url))}),locationTipsContainer.innerHTML=Object.entries(result).sort(function(a,b){return"cottages"===searchType?"Область"===a[0]?1:-1:0}).map(function(entry){return entry[1].join("")}).join(""),initTips()}}catch(e){}}(defaultTips)})})},openTipsList=function(){locationTipsWrapper.classList.remove("filter-popup-hide-n-2"),""===locationInput.value&&dynamicLabel&&dynamicLabel.classList.add("price-output-n-2__dynamic-label_lifted"),bottomLine.classList.add("location-input-n-2__bottom-line_expanded")},getTips=function(){return 0===locationInput.value.length?requestDefaultTips():requestTips()};locationInput.addEventListener("focus",function(event){locationTips.includes(event.relatedTarget)||(getTips(),openTipsList())}),locationInput.addEventListener("keydown",function(event){switch(event.keyCode){case _helpers_constants__WEBPACK_IMPORTED_MODULE_24__.d:return event.preventDefault(),openTipsList(),void(locationTips&&locationTips.length&&locationTips[0].focus());case _helpers_constants__WEBPACK_IMPORTED_MODULE_24__.f:return void closePopup();default:return}}),document.addEventListener("click",function(e){e.target===locationTipsWrapper||e.target===locationInput||e.target.parentNode===locationTipsWrapper||locationTipsWrapper.classList.contains("hide")||closePopup()}),example&&example.addEventListener("click",function(){locationInput.value=example.textContent,locationInput.dispatchEvent(new CustomEvent("change")),dynamicLabel&&dynamicLabel.classList.add("price-output-n-2__dynamic-label_lifted")}),locationInput.addEventListener("input",function(){timeout&&clearTimeout(timeout),timeout=setTimeout(function(){0===locationInput.value.length?requestDefaultTips():requestTips()},200)}),document.activeElement===locationInput?getTips().then(function(){locationTipsWrapper.classList.contains("filter-popup-hide-n-2")&&openTipsList()}):requestDefaultTips()}},281:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__(3),__webpack_require__(7),__webpack_require__(8),__webpack_require__(59),__webpack_require__(26),__webpack_require__(9),__webpack_require__(4),__webpack_require__(12),__webpack_require__(27),__webpack_require__(116),__webpack_require__(1),__webpack_require__(42),__webpack_require__(93),__webpack_require__(2),__webpack_require__(273),__webpack_require__(5),__webpack_require__(74),__webpack_require__(10),__webpack_require__(6);var axios=__webpack_require__(13),axios_default=__webpack_require__.n(axios),pubsub=__webpack_require__(15),pubsub_default=__webpack_require__.n(pubsub),query_string=__webpack_require__(49),query_string_default=__webpack_require__.n(query_string),dropdown=__webpack_require__(187),checkbox_block=__webpack_require__(114),scrollbooster_min=(__webpack_require__(270),__webpack_require__(47),__webpack_require__(271),__webpack_require__(90),__webpack_require__(36),__webpack_require__(48),__webpack_require__(272),__webpack_require__(117),__webpack_require__(186)),scrollbooster_min_default=__webpack_require__.n(scrollbooster_min),utils=__webpack_require__(52),constants=__webpack_require__(11);function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){if(!(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function _toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var CHECK_CIRCLE=document.createElementNS("http://www.w3.org/2000/svg","g");CHECK_CIRCLE.style.pointerEvents="none",CHECK_CIRCLE.innerHTML='<circle cx="0" cy="0" r="6.5" fill="#43b05c" stroke="#fff" stroke-width="1"/><path d="M3.5,-2.25L-1,2.5L-3.25,0.25" fill="none" stroke="#fff" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>';var location_metro_LocationMetro=function(){function LocationMetro(element){var _ref$onChange=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{}).onChange,onChange=void 0===_ref$onChange?function(f){return f}:_ref$onChange;!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LocationMetro),this.element=element,this.scheme=this.element.querySelector(".js-metro-scheme"),this.schemeSvg=this.scheme.querySelector("svg"),this.branchInputs=_toConsumableArray(this.element.querySelectorAll(".js-branch-select input")),this.checkboxIns=this.element.querySelector(".js-metro-ins"),this.checkboxInb=this.element.querySelector(".js-metro-inb"),this.searchInput=this.element.querySelector(".js-search-input"),this.zoomLevel=1,this.zoomIn=this.element.querySelector(".js-metro-scheme-zoom-in"),this.zoomOut=this.element.querySelector(".js-metro-scheme-zoom-out"),this.onChange=onChange,this.init(),this.bindEvents()}var Constructor,protoProps,staticProps;return Constructor=LocationMetro,(protoProps=[{key:"init",value:function(){var _this=this;this.changed={},this.branches=_toConsumableArray(this.element.querySelectorAll(".branch")).map(function(node){return{id:node.getAttribute("data-branch-id"),isActive:!1,node:node,segments:[],stations:[],titles:[]}}),this.segments=[],this.stationsContainer=this.element.querySelector(".stations"),this.stations=_toConsumableArray(this.stationsContainer.querySelectorAll("[data-s]")).map(function(node){return{branches:[],circle:node.querySelector("circle"),geo:node.getAttribute("data-id"),id:node.getAttribute("data-i"),insideSmallCircle:node.hasAttribute("data-ins"),insideBigCircle:node.hasAttribute("data-inb"),isActive:!1,node:node,segmentIds:node.getAttribute("data-s").split(","),segments:[],textNode:node.querySelector(".station-name")}}),this.branches.forEach(function(branch){var segments=_toConsumableArray(branch.node.querySelectorAll(".branch-segment")),titles=_toConsumableArray(branch.node.querySelectorAll(".branch-title"));segments.forEach(function(segmentNode){var _branch$stations,segment={branch:branch,isActive:!1,node:segmentNode},segmentId=segmentNode.getAttribute("data-s"),segmentStations=_this.stations.filter(function(_ref2){return _ref2.segmentIds.includes(segmentId)}).map(function(station){return station.branches.push(branch),station.segments.push(segment),station});segment.id=segmentId,segment.stations=segmentStations,_this.segments.push(segment),branch.segments.push(segment),(_branch$stations=branch.stations).push.apply(_branch$stations,_toConsumableArray(segmentStations))}),titles.forEach(function(title){branch.titles.push({branch:branch,node:title})})}),window.__SEARCH__=window.__SEARCH__||{},window.__SEARCH__.searchInputTips=[],this.stations.forEach(function(station){station.textNode&&window.__SEARCH__.searchInputTips.push({id:station.id,label:station.textNode.textContent.replace(/\s{2,}/g," ").trim()})}),this.scrollBooster=new scrollbooster_min_default.a({viewport:this.scheme.parentNode,content:this.scheme,bounce:!1,onUpdate:function(data){_this.scheme.parentNode.scrollLeft=data.position.x,_this.scheme.parentNode.scrollTop=data.position.y}})}},{key:"bindEvents",value:function(){var _this2=this;if(this.branches.forEach(function(branch){branch.titles.forEach(function(title){var titleNode=title.node;titleNode.addEventListener("click",function(){_this2.changed={},_this2.onBranchClick(branch),branch.stations.forEach(function(station){return _this2.removeStationHover(station)}),_this2.onChange(_this2.changed)}),titleNode.addEventListener("mouseenter",function(){branch.stations.forEach(function(branchStation){return _this2.setStationHover(branchStation)})}),titleNode.addEventListener("mouseleave",function(){branch.stations.forEach(function(branchStation){return _this2.removeStationHover(branchStation)})})})}),this.segments.forEach(function(segment){var segmentNode=segment.node,stations=segment.stations;segmentNode.addEventListener("click",function(){_this2.changed={},_this2.onSegmentClick(segment),stations.forEach(function(station){return _this2.removeStationHover(station)}),segment.branch.isActive=segment.branch.segments.every(function(branchSegment){return branchSegment.isActive}),_this2.onChange(_this2.changed)}),segmentNode.addEventListener("mouseenter",function(){stations.forEach(function(station){return _this2.setStationHover(station)})}),segmentNode.addEventListener("mouseleave",function(){stations.forEach(function(station){return _this2.removeStationHover(station)})})}),this.stations.forEach(function(station){var circle=station.circle,textNode=station.textNode,updateData=function(){station.segments.forEach(function(stationSegment){stationSegment.isActive=stationSegment.stations.every(function(segmentStation){return segmentStation.isActive})}),station.branches.forEach(function(stationBranch){var nextState=stationBranch.stations.every(function(branchStation){return branchStation.isActive});stationBranch.isActive!==nextState&&pubsub_default.a.publish(constants.s,[stationBranch,nextState]),stationBranch.isActive=nextState})};circle.addEventListener("click",function(){_this2.changed={},_this2.onStationClick(station),updateData(),_this2.onChange(_this2.changed)}),textNode&&textNode.addEventListener("click",function(){_this2.changed={},_this2.onStationClick(station),updateData(),_this2.onChange(_this2.changed)})}),this.searchInput){var input=this.searchInput.querySelector("input");input&&input.addEventListener("tipClick",function(event){if(event.detail&&event.detail.tip){var id=event.detail.tip.id,targetStation=_this2.stations.find(function(station){return station.id===id});targetStation&&_this2.onStationClick(targetStation),input.value=""}})}this.branchInputs.length&&(this.branchInputs.forEach(function(input){input.addEventListener("change",function(event){if(!event.detail||!event.detail.ignoreEvent){var branchId=input.getAttribute("data-branch-id");if(branchId){var targetBranch=_this2.branches.find(function(branch){return branch.id===branchId});targetBranch&&(_this2.onBranchClick(targetBranch),_this2.onChange(_this2.changed))}}})}),pubsub_default.a.subscribe(constants.s,function(message,_ref3){var _ref4=_slicedToArray(_ref3,2),branch=_ref4[0],state=_ref4[1],branchId=branch.id,targetInput=_this2.branchInputs.find(function(input){return input.getAttribute("data-branch-id")===branchId});targetInput&&(targetInput.checked=state,targetInput.closest(".checkbox-block-n-2__popup").dispatchEvent(new CustomEvent("change")))}),pubsub_default.a.subscribe(constants.w,function(){_this2.branches.forEach(function(branch){return branch.isActive=!1}),_this2.segments.forEach(function(segment){return segment.isActive=!1}),_this2.stations.forEach(function(station){return _this2.uncheckStation(station)})}),pubsub_default.a.subscribe(constants.x,function(message,data){var id=data.id;if(id.startsWith("location-")){var geoId=id.split("-")[1];if(geoId){var targetStation=_this2.stations.find(function(station){return station.geo===geoId});targetStation&&_this2.uncheckStation(targetStation)}}}),this.checkboxIns&&this.checkboxIns.addEventListener("change",function(event){_this2.changed={},_this2.stations.forEach(function(station){return(station.insideSmallCircle||station.insideBigCircle)&&_this2.onStationClick(station,_this2.checkboxIns.checked)}),_this2.onChange(_this2.changed)}),this.checkboxInb&&this.checkboxInb.addEventListener("change",function(event){_this2.changed={},_this2.stations.forEach(function(station){return station.insideSmallCircle&&_this2.onStationClick(station,_this2.checkboxInb.checked)}),_this2.onChange(_this2.changed)})),new IntersectionObserver(function(entries,observer){entries.some(function(entry){return entry.isIntersecting})&&(_this2.scrollBooster.updateMetrics(),observer.disconnect())}).observe(this.scheme),this.zoomIn&&this.zoomIn.addEventListener("click",function(event){_this2.zoomLevel+=.1,_this2.schemeSvg.style.transform="scale(".concat(_this2.zoomLevel,")"),setTimeout(function(){_this2.scrollBooster.updateMetrics()},500)}),this.zoomOut&&this.zoomOut.addEventListener("click",function(event){_this2.zoomLevel-=.1,_this2.schemeSvg.style.transform="scale(".concat(_this2.zoomLevel,")"),setTimeout(function(){_this2.scrollBooster.updateMetrics()},500)})}},{key:"onBranchClick",value:function(branch){var _this3=this;branch.isActive=!branch.isActive,branch.segments.forEach(function(segment){segment.isActive=branch.isActive,_this3.changeSegmentState(segment)}),pubsub_default.a.publish(constants.s,[branch,branch.isActive])}},{key:"onSegmentClick",value:function(segment){segment.isActive=!segment.isActive,this.changeSegmentState(segment);var nextSegmentBranchState=segment.branch.segments.every(function(branchSegment){return branchSegment.isActive});segment.branch.isActive!==nextSegmentBranchState&&(segment.branch.isActive=nextSegmentBranchState,pubsub_default.a.publish(constants.s,[segment.branch,nextSegmentBranchState]))}},{key:"changeSegmentState",value:function(segment){var _this4=this;segment.isActive?segment.stations.forEach(function(station){return _this4.checkStation(station)}):segment.stations.forEach(function(station){return 0===station.segments.filter(function(stationSegment){return stationSegment.isActive}).length&&_this4.uncheckStation(station)})}},{key:"onStationClick",value:function(station,forceState){var _this5=this,stationState=station.isActive,stations=[station],uniqueStations=[];station.segmentIds.length>1&&(stations=station.segments.map(function(segment){return segment.stations}).flat().filter(function(segmentStation){return!!Object(utils.a)(segmentStation.segmentIds,station.segmentIds)&&(!uniqueStations.includes(segmentStation.id)&&(uniqueStations.push(segmentStation.id),!0))})),stations.forEach(function(s){return function(s){return void 0!==forceState?forceState?_this5.checkStation(s):_this5.uncheckStation(s):stationState?_this5.uncheckStation(s):_this5.checkStation(s)}(s)})}},{key:"checkStation",value:function(station){if(!station.checkCircle){var checkCircleClone=CHECK_CIRCLE.cloneNode(!0);station.node.appendChild(checkCircleClone),station.checkCircle=checkCircleClone}station.isActive||(this.changed[station.geo]=!0),station.isActive=!0}},{key:"uncheckStation",value:function(station){station.checkCircle&&(station.checkCircle.parentNode.removeChild(station.checkCircle),delete station.checkCircle),station.isActive&&(this.changed[station.geo]=!1),station.isActive=!1}},{key:"setStationHover",value:function(station){if(!station.isActive&&!station.hoverCircle){var circleClone=station.circle.cloneNode();circleClone.setAttribute("filter","url(#blur)"),station.node.insertAdjacentElement("afterbegin",circleClone),station.hoverCircle=circleClone}}},{key:"removeStationHover",value:function(station){station.hoverCircle&&station.hoverCircle.parentNode.removeChild(station.hoverCircle),delete station.hoverCircle}},{key:"reset",value:function(){var _this6=this;this.changed={},this.branches.forEach(function(branch){return branch.isActive=!1}),this.branchInputs.forEach(function(input){return input.checked=!1}),this.branchInputs[0].closest(".checkbox-block-n-2__popup").dispatchEvent(new CustomEvent("change")),this.segments.forEach(function(segment){return segment.isActive=!1}),this.stations.forEach(function(station){return _this6.uncheckStation(station)}),this.onChange(this.changed)}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),LocationMetro}(),modal=__webpack_require__(35),search_input=__webpack_require__(143),location_input=__webpack_require__(268),API_LOCATIONS_MODAL=function(url,localhostUrl){if(Object(utils.d)())return localhostUrl;if(Object(utils.e)()){var shouldAppendSlash=void 0!==localhostUrl[0]&&"/"!==localhostUrl[0];return"/build-redesign".concat(shouldAppendSlash?"/":"")+localhostUrl}return url}("/ajax/geo_modal.php","/location-modal.json"),helpers_request=__webpack_require__(60);function location_tabs_slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(arr,i){if(!(Symbol.iterator in Object(arr)||"[object Arguments]"===Object.prototype.toString.call(arr)))return;var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{_n||null==_i.return||_i.return()}finally{if(_d)throw _e}}return _arr}(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function location_tabs_toConsumableArray(arr){return function(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function location_tabs_defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}__webpack_require__.d(__webpack_exports__,"a",function(){return location_tabs_LocationTabsN2});var location_tabs_LocationTabsN2=function(){function LocationTabsN2(controller){var _this=this,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{customSerialize:null,modalContainer:null,onShow:function(f){return f},switchContainer:"",switchType:"radio",tabsContainer:"",withCheckmarks:!1};return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,LocationTabsN2),this.modal=document.querySelector("#modal-location"),this.controller=controller,this.customSerialize="function"==typeof options.customSerialize?options.customSerialize:null,this.onShow=options.onShow,this.modalContainerSelector=options.modalContainer,this.switchContainerSelector=options.switchContainer,this.tabsContainerSelector=options.tabsContainer,this.modalContainer=document.querySelector(this.modalContainerSelector),this.modal?new Promise(function(resolve){_this.init(),resolve(_this)}):this.requestModal().then(function(data){return _this.renderModal(data)}).then(function(){return _this.initAjax()}).then(function(){return _this.init()}).then(function(){return _this})}var Constructor,protoProps,staticProps;return Constructor=LocationTabsN2,(protoProps=[{key:"init",value:function(){var _this2=this,element=document.querySelector("[data-geo-url]");this.geoUrl=element.getAttribute("data-geo-url"),this.geoCountsUrl=element.getAttribute("data-geo-count-url"),this.locationSelect=this.modal.querySelector(".js-location"),this.modalContent=this.modal.querySelector(".js-location-modal"),this.modalLinksContainer=this.modal.querySelector(".js-location-modal-links"),this.modalTabsContainer=this.modal.querySelector(".js-location-modal-tabs"),this.resetButton=this.modal.querySelector(".js-location-modal-reset"),this.showButton=this.modal.querySelector(".js-search-counter"),this.dataCount={},modal.a.init({container:this.controller.element,triggersSelector:".js-location-modal-trigger",modal:{backdropContainer:this.modal.parentNode}}),this.initTabs(),this.bindEvents(),this.switchContainerSelector&&this.tabsContainerSelector&&(this.switchContainer=document.querySelector(this.switchContainerSelector),this.tabsContainer=document.querySelector(this.tabsContainerSelector),this.switchContainer&&this.tabsContainer&&this.initControls()),setTimeout(function(){_this2.requestCounts().then(function(countData){return _this2.updateCounts(countData)})},1)}},{key:"initControls",value:function(){var _this3=this;this.switchContainer&&this.tabsContainer&&(this.switches=location_tabs_toConsumableArray(this.switchContainer.querySelectorAll(".js-geo-tab"))||[],this.tabNodes=location_tabs_toConsumableArray(this.tabsContainer.querySelectorAll(".js-geo-detailed-tab"))||[],this.tabControls={},this.tabNodes.forEach(function(tabNode){location_tabs_toConsumableArray(document.querySelectorAll("[data-tab]")).forEach(function(control){var tabName=control.getAttribute("data-tab");_this3.tabControls[tabName]||(_this3.tabControls[tabName]=[]),_this3.tabControls[tabName].push({control:control,countNode:control.querySelector(".extra-tag-n-2"),resetButton:control.querySelector("[data-reset]")})})}),modal.a.init({container:this.tabsContainer,triggersSelector:"[data-tab]",modal:{backdropContainer:this.modal.parentNode}}),this.bindControlsEvents())}},{key:"initAjax",value:function(){checkbox_block.a.init(this.modal),dropdown.a.init(this.modal),search_input.a.init(this.modal)}},{key:"bindControlsEvents",value:function(){var _this4=this;this.switches.forEach(function(element){element.addEventListener("change",function(event){var firstActiveSwitch=_this4.switches.find(function(input){return input.checked}),tabTarget=_this4.tabNodes[0];if(firstActiveSwitch){var tabId=firstActiveSwitch.getAttribute("data-city-tab"),nextTab=_this4.tabNodes.find(function(tab){return tab.getAttribute("data-city")===tabId});nextTab&&(tabTarget=nextTab)}_this4.tabNodes.forEach(function(tab){tab===tabTarget?tab.classList.add("is-active"):tab.classList.remove("is-active")})})}),Object.entries(this.tabControls).forEach(function(_ref){var _ref2=location_tabs_slicedToArray(_ref,2),key=_ref2[0],controls=_ref2[1],targetTab=_this4.tabs.find(function(tab){return tab.name===key});targetTab&&controls.forEach(function(item){item.resetButton&&item.resetButton.addEventListener("click",function(event){_this4.resetTab(targetTab),_this4.applyTabFilters(targetTab),_this4.updateSearchCounter()})})})}},{key:"initTabs",value:function(){var _this5=this;this.tabs=location_tabs_toConsumableArray(this.modal.querySelectorAll(".js-location-modal-link")).map(function(link,index){return{name:link.getAttribute("data-target"),currentFilters:new Set,isActive:0===index,isInitialized:!1,link:link,tab:_this5.modal.querySelector("#".concat(link.getAttribute("data-target")))}}),this.tabs.forEach(function(item){var _item$letterGroups;item.tab&&(item.letterGroups||(item.letterGroups=[]),(_item$letterGroups=item.letterGroups).push.apply(_item$letterGroups,location_tabs_toConsumableArray(item.tab.querySelectorAll(".js-location-modal-letter-group"))))}),location_tabs_toConsumableArray(this.modalTabsContainer.querySelectorAll(".js-location-input")).forEach(function(input){Object(location_input.a)(input)}),location_tabs_toConsumableArray(this.modalTabsContainer.querySelectorAll('[name="f[geo][]"]')).forEach(function(input){_this5.dataCount[input.value]={input:input,node:input.parentNode.querySelector(".count")}}),this.tabs.length&&this.tabs.forEach(function(tab){return _this5.initTab(tab)}),this.bindTabsEvents()}},{key:"bindTabsEvents",value:function(){var _this6=this;this.tabs.forEach(function(modalTab){var link=modalTab.link;modalTab.tab&&link&&link.addEventListener("change",function(event){event.preventDefault(),event.stopPropagation(),_this6.setActiveTab(modalTab)})})}},{key:"bindEvents",value:function(){var _this7=this;this.locationSelect&&this.locationSelect.addEventListener("dropdown-change",function(event){var input=event.detail.item.input;_this7.request({"f[geo][]":input.value})}),this.modal.addEventListener("show.bs.modal-n-2",function(event){_this7.controller&&_this7.controller.openFilter&&_this7.controller.openFilter();var modalTrigger=_this7.modal.modalTrigger;if(modalTrigger){var modalTabId=modalTrigger.getAttribute("data-tab"),modalTab=_this7.tabs.find(function(tab){return tab.link.getAttribute("data-target")===modalTabId});modalTab&&_this7.setActiveTab(modalTab)}}),this.resetButton&&this.resetButton.addEventListener("click",function(event){var activeTab=_this7.tabs.find(function(tab){return tab.isActive});activeTab&&("location-metro"===activeTab.link.getAttribute("data-target")&&_this7.locationMetro&&_this7.locationMetro.reset(),_this7.resetTab(activeTab),_this7.applyTabFilters(activeTab),_this7.updateSearchCounter())}),this.showButton&&this.showButton.addEventListener("click",function(event){var modal=_this7.modal.Modal||_this7.modal.modalTrigger&&_this7.modal.modalTrigger.Modal;if(modal&&(modal.hide(),modal.backdropContainer)){var backdrop=modal.backdropContainer.querySelector(".modal-n-2-backdrop");backdrop&&backdrop.remove()}document.body.classList.remove("modal-n-2-open"),document.body.style.paddingRight="",_this7.modal.style.display="",_this7.onShow()}),pubsub_default.a.subscribe(constants.l,function(message,payload){var inputs=payload.data,activeTabs=[];inputs.forEach(function(input){var targetTab=_this7.tabs.find(function(tab){return tab.inputs&&tab.inputs.find(function(tabInputs){return tabInputs.input===input})});targetTab&&activeTabs.push(targetTab)}),activeTabs.forEach(function(tab){return _this7.changeExtraTags(tab)})})}},{key:"initTab",value:function(element){var _this8=this,isInitialized=element.isInitialized,tab=element.tab;if(!isInitialized&&tab){var tabFilters=tab.querySelector(".js-location-modal-filters"),tabInputs=location_tabs_toConsumableArray(tab.querySelector(".js-location-modal-body").querySelectorAll("input")).map(function(input){return{id:input.value,input:input,inputFeatures:input.hasAttribute("data-feature")?input.getAttribute("data-feature"):[]}}),tabQuickFilters=location_tabs_toConsumableArray(tabFilters.querySelectorAll(".js-location-modal-filter")).map(function(input){return{input:input,features:input.getAttribute("data-value")}}),groupedCheckboxes=tabQuickFilters.filter(function(_ref3){return _ref3.input.hasAttribute("data-cb-group")}),groupedCheckboxesAll=tabQuickFilters.find(function(_ref4){return _ref4.input.hasAttribute("data-cb-group-all")});element.isInitialized=!0,element.inputs=tabInputs,element.quickFilters=tabQuickFilters,element.filters=location_tabs_toConsumableArray(tabFilters.querySelectorAll("input:not(.js-location-modal-filter)")),groupedCheckboxesAll&&groupedCheckboxesAll.input.addEventListener("change",function(event){event.preventDefault(),event.stopPropagation(),event.stopImmediatePropagation(),groupedCheckboxes.forEach(function(_ref5){var input=_ref5.input;input.checked=groupedCheckboxesAll.input.checked,input.dispatchEvent(new CustomEvent("change",{detail:{ignoreEvent:!0}}))}),_this8.applyTabFilters(element,groupedCheckboxesAll.input.checked),_this8.updateSearchCounter()}),tabInputs.forEach(function(_ref6){var input=_ref6.input,inputFeatures=_ref6.inputFeatures;input.addEventListener("change",function(event){_this8.changeExtraTags(element);var relatedQuickFilter=tabQuickFilters.find(function(filter){return filter.features===inputFeatures});relatedQuickFilter&&!relatedQuickFilter.input.hasAttribute("data-tag-name")&&(relatedQuickFilter.input.checked=!1),groupedCheckboxesAll&&(groupedCheckboxesAll.input.checked=tabInputs.every(function(_ref7){return _ref7.input.checked}))})}),tabQuickFilters.forEach(function(_ref8){var input=_ref8.input,features=_ref8.features;input.addEventListener("change",function(event){input.hasAttribute("data-tag-name")||(event.preventDefault(),event.stopPropagation()),event.target.checked?element.currentFilters.add(features):element.currentFilters.delete(features),event.detail&&event.detail.ignoreEvent||(_this8.applyTabFilters(element),_this8.updateSearchCounter(),_this8.updateControllerForm())})}),tab.querySelector(".location-modal-tab__scheme")&&(this.locationMetro=new location_metro_LocationMetro(tab,{onChange:function(obj){Object.entries(obj).forEach(function(_ref9){var _ref10=location_tabs_slicedToArray(_ref9,2),key=_ref10[0],state=_ref10[1],targetInput=tabInputs.find(function(input){return input.id===key});targetInput&&(targetInput.input.checked=state,_this8.controller.toggleTag&&_this8.controller.toggleTag(targetInput.input),_this8.changeExtraTags(element))}),_this8.updateSearchCounter(),_this8.updateControllerForm()}}))}}},{key:"changeExtraTags",value:function(element){if(this.tabControls){var inputs=element.inputs,tab=element.tab,controls=this.tabControls[tab.id];if(controls){var checkedLocations=inputs.filter(function(_ref11){return _ref11.input.checked});controls.forEach(function(_ref12){var control=_ref12.control,countNode=_ref12.countNode,action=checkedLocations.length?"add":"remove";control&&control.classList[action]("has-value"),countNode&&(countNode.innerText=checkedLocations.length||"")})}}}},{key:"applyTabFilters",value:function(element,forceState){var _this9=this,currentFilters=element.currentFilters,inputs=element.inputs;inputs&&(currentFilters.size?inputs.forEach(function(_ref13){var input=_ref13.input,inputFeatures=_ref13.inputFeatures;input.disabled||(input.checked=void 0!==forceState?forceState:!!currentFilters.has(inputFeatures))}):inputs.forEach(function(_ref14){_ref14.input.checked=void 0!==forceState&&forceState}),this.controller.toggleTag&&inputs.forEach(function(_ref15){var input=_ref15.input;input.disabled||_this9.controller.toggleTag(input)}),this.changeExtraTags(element))}},{key:"setActiveTab",value:function(modalTab){var _this10=this,link=modalTab.link,tab=modalTab.tab;this.tabs.forEach(function(_ref16,index){var otherTab=_ref16.tab;otherTab&&(tab!==otherTab?otherTab.classList.remove("is-active"):(link.checked=!0,tab.classList.add("is-active")),_this10.tabs[index].isActive=tab===otherTab)})}},{key:"resetTab",value:function(tab){var currentFilters=tab.currentFilters,filters=tab.filters,inputs=tab.inputs,quickFilters=tab.quickFilters;currentFilters.clear(),inputs&&inputs.forEach(function(_ref17){_ref17.input.checked=!1}),quickFilters&&quickFilters.forEach(function(_ref18){_ref18.input.checked=!1}),filters&&filters.forEach(function(filter){"checkbox"===filter.type?filter.checked=!1:filter.value=""}),"location-metro"===tab.link.getAttribute("data-target")&&this.locationMetro&&this.locationMetro.reset()}},{key:"resetTabs",value:function(){var _this11=this;this.tabs&&this.tabs.forEach(function(tab){return _this11.resetTab(tab)})}},{key:"resetSwitches",value:function(){this.switches&&this.switches.forEach(function(element){element.checked=!1})}},{key:"request",value:function(params){var _this12=this;if(!this.geoUrl)return Promise.reject("");this.modalContent.classList.add("is-loading"),this.modalContent.classList.add("spinner"),this.searchType=Object(helpers_request.c)(this.geoUrl).type;var finallyCallback=function(){_this12.modalContent.classList.remove("is-loading"),_this12.modalContent.classList.remove("spinner")},request=axios_default.a.get(this.geoUrl,{params:params}).then(function(response){return response.data}).catch(function(error){}).finally(function(){return finallyCallback()});return this.geoCountsUrl?Promise.all([request,this.requestCounts()]).then(function(_ref19){var _ref20=location_tabs_slicedToArray(_ref19,2),data=_ref20[0],countData=_ref20[1];data&&(_this12.render(data),_this12.updateCounts(countData))}).finally(function(){return finallyCallback()}):request.then(function(data){data&&_this12.render(data)})}},{key:"render",value:function(data){var links=data.links,modalTabs=data.modalTabs,switches=data.switches,tabs=data.tabs;links&&tabs&&modalTabs&&switches&&(this.switchContainer&&(this.switchContainer.innerHTML=switches),this.tabsContainer&&(this.tabsContainer.innerHTML=tabs),this.modalLinksContainer.innerHTML=links,this.modalTabsContainer.innerHTML=modalTabs,this.initTabs(),this.initControls(),checkbox_block.a.init(this.modalTabsContainer))}},{key:"renderModal",value:function(data){data&&data.html&&(this.modal=Object(utils.c)(data.html),this.modalContainer.appendChild(this.modal))}},{key:"requestCounts",value:function(params){params||(params=this.customSerialize?this.customSerialize():{});var paramsWithoutGeo={};return Object.entries(params).forEach(function(_ref21){var _ref22=location_tabs_slicedToArray(_ref21,2),key=_ref22[0],value=_ref22[1];paramsWithoutGeo[key]=value}),axios_default.a.get(this.geoCountsUrl,{params:paramsWithoutGeo}).then(function(response){return response&&response.data}).catch(function(e){return{}})}},{key:"requestModal",value:function(){var requestData={};return window.__SEARCH__&&window.__SEARCH__.geo&&(requestData.geo=window.__SEARCH__.geo),axios_default.a.get(API_LOCATIONS_MODAL,{params:requestData,paramsSerializer:function(params){return query_string_default.a.stringify(params,{arrayFormat:"comma"})}}).then(function(response){return response&&response.data}).catch(function(e){return{}})}},{key:"updateCounts",value:function(data){this.dataCount&&Object.entries(this.dataCount).forEach(function(_ref23){var _ref24=location_tabs_slicedToArray(_ref23,2),key=_ref24[0],value=_ref24[1],input=value.input,node=value.node,countsData=data[key];input&&(input.disabled=!countsData||!countsData),node&&(node.innerText=countsData?"(".concat(countsData,")"):"0")})}},{key:"updateControllerForm",value:function(){"MapSearch"===this.controller.ModuleName&&this.controller.form.dispatchEvent(new CustomEvent("change"))}},{key:"updateSearchCounter",value:function(){this.controller.searchCounter&&this.controller.searchCounter.defferedRequest()}}])&&location_tabs_defineProperties(Constructor.prototype,protoProps),staticProps&&location_tabs_defineProperties(Constructor,staticProps),LocationTabsN2}()}}]);